<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="{% static 'style.css' %}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <title>Online Timesheet</title>    
    <style>
        body {
            background-color: rgb(118, 175, 222);
        }

        .titlecontents {
            background-color: #ffffff; /* White background for title section */
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .page1 {
            margin-top: 0%;
            display: flex;
            flex-direction: column;
            align-items: left;
        }

        .page1 .input-group {
            width: 100%; 
            max-width: 60%; 
            margin-left: 20%;
        }

        .page1 .m-signature-pad {
            width: 100%; 
            max-width: 60%; 
            margin-bottom: 1rem; 
            margin-left: 20%;

        }

        .page1 .m-signature-pad canvas {
            width: 60%; 
            margin-left: 20%;
            margin-top: 1%;
            background-color: white;
            border:2px solid
        }

        .backbutton {
            text-align: center;
            margin-bottom: 1rem;
        }

        .form-buttons {
            display: flex;
            margin: 10%;
        }
    </style>
</head>
<body>
    <div class="titlecontents text-center my-4">
        <h1>Divine Health and Care Services</h1>
        <h2>Online Timesheet</h2>
    </div>
    <div class="backbutton">
        <a href="{% url 'staff-front' %}">
            <button type="button" class="btn btn-secondary">Back</button>
        </a>    
    </div>

    <div class="page1">
        <form id="timesheet-form" method="post" action="{% url 'submit-timesheet' %}" enctype="multipart/form-data">
            {% csrf_token %}
            
            <!-- First and Last Name (Assuming these are pre-filled from logged-in user) -->
            <div class="input-group mb-3">
                <span class="input-group-text">First Name</span>
                <input type="text" class="form-control" name="first_name" value="{{ user.first_name }}" readonly>
            </div>
            <div class="input-group mb-3">
                <span class="input-group-text">Last Name</span>
                <input type="text" class="form-control" name="last_name" value="{{ user.last_name }}" readonly>
            </div>
            
            <!-- Care Home Name (Dropdown) -->
            <div class="input-group mb-3">
                <label class="input-group-text" for="care_home">Name of the Care home</label>
                <select class="form-select" id="care_home" name="care_home_name">
                    <option selected disabled>Select Care Home</option>
                    {% for client in form.fields.care_home_name.queryset %}
                        <option value="{{ client.id }}">{{ client.username }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <!-- Date of Work (Default to Current Date) -->
            <div class="input-group mb-3">
                <span class="input-group-text">Date of Work</span>
                <input type="date" class="form-control" name="date_of_work" value="{{ form.fields.date_of_work.initial|date:'Y-m-d' }}" required>
            </div>

            <!-- Shift Started Time -->
            <div class="input-group mb-3">
                <span class="input-group-text">Shift Started Time</span>
                <input type="datetime-local" class="form-control" name="shift_started_time" id="shift_started_time" required>
            </div>

            <!-- Break Started Time -->
            <div class="input-group mb-3">
                <span class="input-group-text">Break Started Time</span>
                <input type="time" class="form-control" name="break_started_time" id="break_started_time" required>
            </div>

            <!-- Break Finished Time -->
            <div class="input-group mb-3">
                <span class="input-group-text">Break Finished Time</span>
                <input type="time" class="form-control" name="break_finished_time" id="break_finished_time" required>
            </div>

            <!-- Shift Finished Time -->
            <div class="input-group mb-3">
                <span class="input-group-text">Shift Finished Time</span>
                <input type="datetime-local" class="form-control" name="shift_finished_time" id="shift_finished_time" required>
            </div>

            <!-- Staff Signature (Canvas) -->
            <div id="signature-pad" class="m-signature-pad">
                <span class="input-group-text">Staff Signature</span>
                <div class="m-signature-pad--body">
                    <canvas id="staff_signature_canvas"></canvas>
                    <input type="hidden" name="staff_signature_image" id="staff_signature_image">
                </div>
            </div>
                
            <!-- Name of the Client Rep. -->
            <div class="input-group mb-3">
                <span class="input-group-text">Name of the Client Rep.</span>
                <input type="text" class="form-control" name="client_rep_name" maxlength="30" size="30" required>
            </div>

            <!-- Position -->
            <div class="input-group mb-3">
                <span class="input-group-text">Position</span>
                <input type="text" class="form-control" name="client_rep_position" maxlength="30" size="30" required>
            </div>

            <!-- Client Rep. Signature (Canvas) -->
            <div id="signature-pad" class="m-signature-pad">
                <span class="input-group-text">Client Rep. Signature</span>
                <div class="m-signature-pad--body">
                    <canvas id="client_signature_canvas"></canvas>
                    <input type="hidden" name="client_rep_signature_image" id="client_rep_signature_image">
                </div>
            </div>

            <!-- Submit and Reset Buttons -->
            <div class="form-buttons">
                <button type="button" class="btn btn-primary" style="margin-left: 85%;" onclick="resetForm()">Reset</button>
                <button type="submit" class="btn btn-primary" style="margin-left: 1%;">Submit</button>
            </div>
        </form>
    </div>
  
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
    <script>
        // Initialize Signature Pad for Staff Signature
        var staffSignaturePad = new SignaturePad(document.getElementById('staff_signature_canvas'));
        var staffSignatureInput = document.getElementById('staff_signature_image');

        // Initialize Signature Pad for Client Rep Signature
        var clientSignaturePad = new SignaturePad(document.getElementById('client_signature_canvas'));
        var clientSignatureInput = document.getElementById('client_rep_signature_image');

        // Save signature as image data when the form is submitted
        document.querySelector('form').addEventListener('submit', function (event) {
            staffSignatureInput.value = staffSignaturePad.toDataURL();
            clientSignatureInput.value = clientSignaturePad.toDataURL();
        });

        // Function to reset the form except for specific fields
        function resetForm() {
            var form = document.getElementById('timesheet-form');
            form.reset();

            // Refill the read-only fields with their original values
            form.first_name.value = "{{ user.first_name }}";
            form.last_name.value = "{{ user.last_name }}";
            form.date_of_work.value = "{{ form.fields.date_of_work.initial|date:'Y-m-d' }}";

            // Clear the signatures
            staffSignaturePad.clear();
            clientSignaturePad.clear();
        }
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Get the current date
            let now = new Date();
            
            // Format the date to YYYY-MM-DD
            let dateStr = now.toISOString().split('T')[0];
            
            // Set the default values with the current date and specific times
            document.getElementById('shift_started_time').value = dateStr + 'T08:00';
            document.getElementById('shift_finished_time').value = dateStr + 'T20:00';
        });
    </script>
    
</body>
</html>
